!function(){"use strict";d3.timeline=function(){function a(a){function b(a){return n.left+(a.starting_time-l)*B}function i(a){return(a.ending_time-a.starting_time)*B}function j(){if(g||w.attr("height"))g?w.attr("height",g):g=w.attr("height");else{if(!q)throw"height of the timeline is not set";g=G.height+G.top-v.top,d3.select(a[0][0]).attr("height",g)}}function s(){if(!f&&!v.width)throw"width of the timeline is not set";f&&v.width||(f?w.attr("width",f):f=w.attr("width"))}function t(a,b,c,d,e){return"M"+a+","+b+"h"+(c-e)+"a"+e+","+e+" 0 0 1 "+e+","+e+"v"+(d-2*e)+"a"+e+","+e+" 0 0 1 "+-e+","+e+"h"+(e-c)+"z"}var u=a.append("g"),v=a[0][0].getBoundingClientRect(),w=d3.select(a[0][0]),x={},y=1,z=0,A=0;s(),(o||0===m&&0===l)&&(u.each(function(a){a.forEach(function(a,b){o&&-1==Object.keys(x).indexOf(b)&&(x[b]=y,y++),0===m&&0===l&&a.events.forEach(function(a){(a.starting_time<z||0===z)&&(z=a.starting_time),a.ending_time>A&&(A=a.ending_time)})})}),0===m&&0===l&&(l=z,m=A));var B=1/(m-l)*(f-n.left-n.right),C=h.format,D=function(a){return k+parseInt(C(a),null)/12},E=d3.time.scale().domain([l,m]).range([n.left,f-n.right]),F=d3.svg.axis().scale(E).orient(e).tickFormat(D).tickSubdivide(1).tickValues(d3.range(l,m+1,12)).tickSize(h.tickSize,h.tickSize/2,0);u.append("g").attr("class","axis").attr("transform","translate(0,"+(n.top+(q+r)*y)+")").call(F),u.each(function(e){e.forEach(function(e,f){function g(){return o?n.top+(q+r)*x[f]:n.top}var h=e.population.events,j="undefined"!=typeof e.label;u.selectAll("svg").data(h).enter().append("path").attr("id","line-path").attr("d",function(a,c){var d=b(a,c),e=g(a,c),f=i(a,c);return t(d,e,f,q,5)}).style("fill",e.population.color).on("mouseover",function(a){c(a,f,e)}).on("click",function(a){d(a,f,e)}).append("title").text(function(a){return a.title}),j&&a.append("text").attr("class","timeline-label").attr("transform","translate(0,"+(q/2+n.top+(q+r)*x[f])+")").text(j?e.label:e.id),"undefined"!=typeof e.icon&&a.append("image").attr("class","timeline-label").attr("transform","translate(0,"+(n.top+(q+r)*x[f])+")").attr("xlink:href",e.icon).attr("width",n.left).attr("height",q)})}),p&&u.selectAll("text").attr("transform",function(){return"rotate("+p+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"});var G=u[0][0].getBoundingClientRect();j()}var b=["circle","rect"],c=function(){},d=function(){},e="bottom",f=null,g=null,h={format:d3.format("d"),tickTime:1,tickNumber:1,tickSize:10},i=d3.scale.category20(),j="rect",k=0,l=0,m=0,n={left:30,right:30,top:30,bottom:30},o=!1,p=!1,q=10,r=5;return a.margin=function(b){return arguments.length?(n=b,a):n},a.orient=function(b){return arguments.length?(e=b,a):e},a.itemHeight=function(b){return arguments.length?(q=b,a):q},a.itemMargin=function(b){return arguments.length?(r=b,a):r},a.height=function(b){return arguments.length?(g=b,a):g},a.width=function(b){return arguments.length?(f=b,a):f},a.display=function(c){return arguments.length&&-1!=b.indexOf(c)?(j=c,a):j},a.tickFormat=function(b){return arguments.length?(h=b,a):h},a.hover=function(b){return arguments.length?(c=b,a):c},a.click=function(b){return arguments.length?(d=b,a):d},a.colors=function(b){return arguments.length?(i=b,a):i},a.startYear=function(b){return arguments.length?(k=b,a):k},a.beginning=function(b){return arguments.length?(l=b,a):l},a.ending=function(b){return arguments.length?(m=b,a):m},a.rotateTicks=function(b){return p=b,a},a.stack=function(){return o=!o,a},a}}(),function(a){"use strict";function b(b){var d=Number.MAX_VALUE,e=Number.MIN_VALUE;return a.each(b,function(b,f){f.hasOwnProperty("dataCollectionEvents")&&a.each(f.dataCollectionEvents,function(a,b){d=Math.min(d,b.startYear),e=Math.max(e,c(b.hasOwnProperty("endYear")?b.endYear-d:0,b.hasOwnProperty("endMonth")?b.endMonth:12))})}),{min:0,max:12*Math.ceil(e/12),start:d}}function c(a,b){return 12*parseInt(a,10)+parseInt(b,10)}function d(a,b){var c=e(a,b);if(0===c.length)return null;var d={start:b.start,min:0,max:b.max,data:c};return d}function e(b,d){function e(b,c){return function(e,j){var k=[];i={},f(i,j,"id"),g(i,j,"name"),i.color=c.nextColor(),j.hasOwnProperty("dataCollectionEvents")&&j.dataCollectionEvents.length>0&&(h(k,i,j.dataCollectionEvents,d),a.each(k,function(a,c){b.push(c)}))}}function f(a,b,c){b.hasOwnProperty(c)&&(a[c]=b[c])}function g(a,b,c){b.hasOwnProperty(c)&&(a.title=b[c][0].value)}function h(b,d,e,h){function i(a,b,c,d){return Math.min(b,d)-Math.max(c,a)>0}function j(a,b,c){var d=jQuery.extend({},a);return d.events=[k(b,c)],{population:d}}function k(a,b){var c={};return f(c,a,"id"),g(c,a,"name"),m(c,a,b),o(c,a,b),c}function l(a,b){var d=a.hasOwnProperty("startYear")?a.startYear:0,e=a.hasOwnProperty("startMonth")?a.startMonth-1:0;return c(d-b.start,d>0?e:0)}function m(a,b,c){a.starting_time=l(b,c)}function n(a,b){var d=a.hasOwnProperty("endYear")?a.endYear:0,e=a.hasOwnProperty("endMonth")?a.endMonth:12;return c(d>0?d-b.start:1,d>0?e:0)}function o(a,b,c){a.ending_time=n(b,c)}if(!jQuery.isEmptyObject(e)){var p=!1;e[0].endYear&&(p=!0,b.push(j(d,e[0],h))),a.each(e,function(c,e){if(!e.endYear||p&&0===c)return!0;var f=!0;a.each(b,function(a,b){var c=b.population.events[b.population.events.length-1],d=l(e,h),g=n(e,h);return i(d,g,c.starting_time,c.ending_time)?void 0:(b.population.events.push(k(e,h)),f=!1,!1)}),f&&e.endYear&&b.push(j(d,e,h))})}}if(null!==b&&b.hasOwnProperty("populations")){var i,j=new a.ColorGenerator,k=[];return a.each(b.populations,e(k,j)),k}}a.StudyDtoParser=function(){},a.StudyDtoParser.prototype={parse:function(a){return a.populations?d(a,b(a.populations)):null}}}(jQuery),function(a){"use strict";function b(a,b){var c=String(a).replace(/[^0-9a-f]/gi,"");c.length<6&&(c=c[0]+c[0]+c[1]+c[1]+c[2]+c[2]),b=b||0;var d,e,f="#";for(e=0;3>e;e++)d=parseInt(c.substr(2*e,2),16),d=Math.round(Math.min(Math.max(0,d+d*b),255)).toString(16),f+=("00"+d).substr(d.length);return f}var c=["#9a3034","#886e6a","#dc9351","#0078ad","#8db173","#bca68e","#707175","#ff7901","#88697b","#99c1c3","#306d05","#f25314"];a.ColorGenerator=function(a){this.colorPalette=jQuery.isEmptyObject(a)?c:a,this.index=0,this.rotation=1},a.ColorGenerator.prototype={nextColor:function(){var a=b(this.colorPalette[this.index],(this.rotation%10===0?-1:1)*this.rotation/70);return this.index=(this.index+1)%this.colorPalette.length,0===this.index&&this.rotation++,a}}}(jQuery),function(a){"use strict";function b(b,c,d,e){var f=a(d).width(),g=d3.timeline().startYear(c.start).beginning(c.min).ending(c.max).width(f).stack().tickFormat({format:d3.format("d"),tickTime:1,tickNumber:1,tickSize:10}).margin({left:15,right:15,top:0,bottom:20}).rotateTicks(c.max>a.MicaTimeline.defaultOptions.maxMonths?45:0).click(function(c,d,f){if(b.popupIdFormatter){var g=a(b.popupIdFormatter(e,f.population,c));g.length>0&&g.modal()}});d3.select(d).append("svg").attr("width",f).datum(c.data).call(g),b.useBootstrapTooltip===!0&&d3.select(d).selectAll("#line-path").attr("data-placement","top").attr("data-toggle","tooltip").attr("data-original-title",function(a){return a.title}).selectAll("title").remove(),b.timelineData=c,b.selectee=d}function c(b,c){var d="<rect width='20' height='20' x='2' y='2' rx='5' ry='5' style='fill:COLOR;'>".replace(/COLOR/,b);return a("<li><svg width='25' height='25'>"+d+"</svg>"+c+"</li>")}a.MicaTimeline=function(a,b,c){this.parser=a,this.popupIdFormatter=b,this.useBootstrapTooltip=c},a.MicaTimeline.prototype={create:function(a,c){if(null!==this.parser&&null!==c){var d=this.parser.parse(c);return d&&b(this,d,a,c),this}},addLegend:function(){if(this.timelineData&&this.timelineData.hasOwnProperty("data")&&0!==this.timelineData.data.length){var b=a("<ul id='legend' class='timeline-legend'>");a(this.selectee).after(b);var d={};return a.each(this.timelineData.data,function(e,f){if(!d.hasOwnProperty(f.population.title)){d[f.population.title]=!0;var g=a(c(f.population.color,f.population.title));b.append(g)}}),this}}},a.MicaTimeline.defaultOptions={maxMonths:300}}(jQuery);