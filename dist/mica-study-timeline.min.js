!function(){"use strict";d3.timeline=function(){function a(a){function b(){return d3.svg.axis().scale(E).orient("bottom").tickFormat("").tickSubdivide(1).tickValues(d3.range(l.getFullYear(),m.getFullYear()+1)).tickSize(-g,i.tickSize/2,0)}function j(a,b){return n.left+(a.starting_time-l)*D}function k(a,b){return(a.ending_time-a.starting_time)*D}function s(a){if(y.attr("height"))g=h?h:y.attr("height");else{if(!q)throw"height of the timeline is not set";g=a.height+a.top-x.top}}function t(b){if(h||y.attr("height"))h?y.attr("height",h):h=y.attr("height");else{if(!q)throw"height of the timeline is not set";h=b.height+b.top-x.top,d3.select(a[0][0]).attr("height",h)}}function u(){if(!f&&!x.width)throw"width of the timeline is not set";f&&x.width||(f?y.attr("width",f):f=y.attr("width"))}function v(a,b,c,d,e){return"M"+a+","+b+"h"+(c-e)+"a"+e+","+e+" 0 0 1 "+e+","+e+"v"+(d-2*e)+"a"+e+","+e+" 0 0 1 "+-e+","+e+"h"+(e-c)+"z"}var w=a.append("g"),x=a[0][0].getBoundingClientRect(),y=d3.select(a[0][0]),z={},A=1,B=0,C=0;u(),(o||0===m&&0===l)&&(w.each(function(a,b){a.forEach(function(a,b){o&&Object.keys(z).indexOf(b)==-1&&(z[b]=A,A++),0===m&&0===l&&a.events.forEach(function(a,b){(a.starting_time<B||0===B)&&(B=a.starting_time),a.ending_time>C&&(C=a.ending_time)})})}),0===m&&0===l&&(l=B,m=C));var D=1/(m-l)*(f-n.left-n.right),E=d3.time.scale().domain([l.getFullYear(),m.getFullYear()]).range([n.left,f-n.right]),F=d3.svg.axis().scale(E).orient(e).tickFormat(i.format).tickSubdivide(1).tickValues(d3.range(l.getFullYear(),m.getFullYear()+1)).tickSize(i.tickSize,i.tickSize/2,0);w.append("g").attr("class","axis").attr("transform","translate(0,"+(n.top+(q+r)*A)+")").call(F),s(w[0][0].getBoundingClientRect()),p&&w.selectAll("text").attr("transform",function(a){return"rotate("+p+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"}),t(w[0][0].getBoundingClientRect()),w.append("g").attr("class","grid").attr("transform","translate(0,"+(g-2*i.tickSize)+")").call(b()),w.append("g").attr("class","grid-tooltip").attr("transform","translate(0,"+(g-2*i.tickSize)+")").call(b()),d3.selectAll(".grid-tooltip > .tick").each(function(a,b){d3.select(this).insert("title",":first-child").html(a)}),w.each(function(b,e){b.forEach(function(b,e){function f(a,b){return o?n.top+(q+r)*z[e]:n.top}var g=b.events,h="undefined"!=typeof b.label;if(w.selectAll("svg").data(g).enter().append("path").attr("id","line-path").attr("d",function(a,b){var c=j(a,b),d=f(a,b),e=k(a,b);return v(c,d,e,q,5)}).style("fill",b.color).on("mouseover",function(a,d){c(a,e,b)}).on("click",function(a,c){d(a,e,b)}).append("title").text(function(a){return a.title}),h){var i=q+r,l=n.top+i/2+i*(z[e]||1);a.append("text").attr("class","timeline-label").attr("text-anchor","end").attr("transform","translate("+(n.left-r)+","+l+")").text(h?b.label:b.id).on("click",function(b,c){console.log("label click!");var d=mouse(this);a.append("rect").attr("id","clickpoint").attr("x",d[0]).attr("width",10).attr("height",q)})}"undefined"!=typeof b.icon&&a.append("image").attr("class","timeline-label").attr("transform","translate(0,"+(n.top+(q+r)*z[e])+")").attr("xlink:href",b.icon).attr("width",n.left).attr("height",q)})})}var b=["circle","rect"],c=function(){},d=function(){},e="bottom",f=null,g=null,h=null,i={format:d3.format("d"),tickTime:1,tickNumber:1,tickSize:10},j=d3.scale.category20(),k="rect",l=0,m=0,n={left:30,right:30,top:30,bottom:30},o=!1,p=!1,q=10,r=5;return a.margin=function(b){return arguments.length?(n=b,a):n},a.orient=function(b){return arguments.length?(e=b,a):e},a.itemHeight=function(b){return arguments.length?(q=b,a):q},a.itemMargin=function(b){return arguments.length?(r=b,a):r},a.height=function(b){return arguments.length?(h=b,a):h},a.width=function(b){return arguments.length?(f=b,a):f},a.display=function(c){return arguments.length&&b.indexOf(c)!=-1?(k=c,a):k},a.tickFormat=function(b){return arguments.length?(i=b,a):i},a.hover=function(b){return arguments.length?(c=b,a):c},a.click=function(b){return arguments.length?(d=b,a):d},a.colors=function(b){return arguments.length?(j=b,a):j},a.beginning=function(b){return arguments.length?(l=b,a):l},a.ending=function(b){return arguments.length?(m=b,a):m},a.rotateTicks=function(b){return p=b,a},a.stack=function(){return o=!o,a},a}}(),function(a){"use strict";function b(a){const b=a.split(/-/).map(function(a){return parseInt(a)});return c(b[0],b[1]-1,b[2])}function c(a,b,c){return new Date(a,b,c)}function d(a,b){return c(a,(b||1)-1,1)}function e(a,b){var d=(b||12)-1,e=new Date(a,d+1,0).getDate();return c(a,d,e)}function f(a){(a||[]).sort(function(a,b){return a.weight-b.weight})}function g(c){a.each(c,function(c,g){g.hasOwnProperty("dataCollectionEvents")&&(f(g.dataCollectionEvents),a.each(g.dataCollectionEvents,function(a,c){c.startDate=c.startDay?b(c.startDay):d(c.startYear,c.startMonth);var f=c.endYear;f||(f=l>c.startYear?l:c.startYear),c.endDate=c.endDay?b(c.endDay):e(f,c.endMonth)}))})}function h(b){var c=Number.MAX_VALUE,e=Number.MIN_VALUE;return a.each(b,function(b,d){d.hasOwnProperty("dataCollectionEvents")&&a.each(d.dataCollectionEvents,function(a,b){c=Math.min(c,b.startDate.getFullYear());var d=b.endDate.getFullYear();e<d&&(e=d)})}),{min:d(c),max:d(e+1)}}function i(a,b){var c=j(a,b);if(0===c.length)return null;var d={start:b.start,min:b.min,max:b.max,data:c};return d}function j(b,c){function d(b,d){return function(f,j){var k=[];i={},e(i,j,"id"),g(i,j,"name"),i.color=d.nextColor(),j.hasOwnProperty("dataCollectionEvents")&&j.dataCollectionEvents.length>0&&(h(k,i,j.dataCollectionEvents,c),a.each(k,function(a,c){b.push(c)}))}}function e(a,b,c){b.hasOwnProperty(c)&&(a[c]=b[c])}function f(b){var c=b[0].value;return a.each(b,function(a,b){b.lang==k&&(c=b.value)}),c}function g(a,b,c){b.hasOwnProperty(c)&&(a.title=f(b[c]))}function h(b,c,d,f){function h(a,b,c,d){return Math.min(b,d)-Math.max(c,a)>0}function i(a,b,c){var d=jQuery.extend({},a);return d.events=[j(b,c)],d}function j(a,b){var c={};return e(c,a,"id"),g(c,a,"name"),k(c,a,b),l(c,a,b),c}function k(a,b,c){a.starting_time=b.startDate}function l(a,b,c){a.ending_time=b.endDate}if(!jQuery.isEmptyObject(d)){var m=jQuery.extend(!0,{},d);a.each(m,function(a,d){if("0"===a)b.push(i(c,d,f));else{for(var e=b[b.length-1].events,g=d.startDate,k=d.endDate,l=!1,m=null,n=e.length-1;n>=0&&!l;n--)m=e[n],h(g,k,m.starting_time,m.ending_time)&&(b.push(i(c,d,f)),l=!0);l||e.push(j(d,f,m.groupId))}})}}if(null!==b&&b.hasOwnProperty("populations")){var i,j=new a.ColorGenerator,l=[];return a.each(b.populations,d(l,j)),l}}var k,l=(new Date).getFullYear();a.StudyDtoParser=function(a){k=a?a:"en"},a.StudyDtoParser.prototype={parse:function(a){return a.populations?(g(a.populations),i(a,h(a.populations))):null}}}(jQuery),function(a){"use strict";function b(a,b,c){return new Date(a,b,c)}function c(a,c){return b(a,(c||1)-1,1)}function d(a,c){var d=(c||12)-1,e=new Date(a,d+1,0).getDate();return b(a,d,e)}function e(a){!a.hasOwnProperty("model")&&a.hasOwnProperty("content")&&(a.model=JSON.parse(a.content))}function f(a){a.model.startDate=c(a.model.startYear);var b=a.endYear;b||(b=r>a.model.startYear?r:a.model.startYear),a.model.endDate=d(b)}function g(b){a.each(b,function(a,b){e(b),f(b)})}function h(b){var d=Number.MAX_VALUE,e=Number.MIN_VALUE;return a.each(b,function(a,b){if(b.model){d=Math.min(d,b.model.startDate.getFullYear());var c=b.model.endDate.getFullYear();e<c&&(e=c)}}),{min:c(d),max:c(e+1)}}function i(b,c){var d,e=(new a.ColorGenerator).nextColor(),f=[],g="";if(a.each(b,function(a,b){d={},j(d,b,"id"),l(d,b,"name"),d.label=k(b.acronym),d.color=e,g.length<d.label.length&&(g=d.label),f.push(m(d,b,c))}),f.length<1)return null;var h={start:c.start,min:c.min,max:c.max,data:f,longestLabel:g};return h}function j(a,b,c){b.hasOwnProperty(c)&&(a[c]=b[c])}function k(b){var c=b[0].value;return a.each(b,function(a,b){b.lang==q&&(c=b.value)}),c}function l(a,b,c){b.hasOwnProperty(c)&&(a.title=k(b[c]))}function m(a,b,c){var d=jQuery.extend({},a);return d.events=[n(b)],d}function n(a){var b={};return j(b,a,"id"),l(b,a,"name"),o(b,a),p(b,a),b}function o(a,b){a.starting_time=b.model.startDate}function p(a,b){a.ending_time=b.model.endDate}var q,r=(new Date).getFullYear();a.StudiesDtoParser=function(a){q=a?a:"en"},a.StudiesDtoParser.prototype={parse:function(a){if(a){g(a);var b=i(a,h(a));return b}return null}}}(jQuery),function(a){"use strict";function b(a,b){var c=String(a).replace(/[^0-9a-f]/gi,"");c.length<6&&(c=c[0]+c[0]+c[1]+c[1]+c[2]+c[2]),b=b||0;var d,e,f="#";for(e=0;e<3;e++)d=parseInt(c.substr(2*e,2),16),d=Math.round(Math.min(Math.max(0,d+d*b),255)).toString(16),f+=("00"+d).substr(d.length);return f}var c=["#9a3034","#886e6a","#dc9351","#0078ad","#8db173","#bca68e","#707175","#ff7901","#88697b","#99c1c3","#306d05","#f25314"];a.ColorGenerator=function(a){this.colorPalette=jQuery.isEmptyObject(a)?c:a,this.index=0,this.rotation=1},a.ColorGenerator.prototype={nextColor:function(){var a=b(this.colorPalette[this.index],(this.rotation%10===0?-1:1)*this.rotation/70);return this.index=(this.index+1)%this.colorPalette.length,0===this.index&&this.rotation++,a}}}(jQuery),function(a){"use strict";function b(a){if(d3){var b=d3.select("body").append("svg");b.append("text").attr("class","timeline-label").attr({x:-99999,y:-99999}).text(a);var c=b.node().getBBox();return b.remove(),{width:c.width,height:c.height}}}function c(c,d,e,f){var g=a(e).width(),h={left:15+(d.longestLabel?b(d.longestLabel).width:0),right:15,top:0,bottom:20},i=d3.timeline().beginning(d.min).ending(d.max).width(g).stack().tickFormat({format:d3.format("d"),tickTime:1,tickNumber:1,tickSize:10}).margin(h).rotateTicks(d.max.getFullYear()-d.min.getFullYear()>30?45:0).click(function(b,d,e){if(c.popupIdFormatter){var g=a(c.popupIdFormatter(f,e.population,b));g.length>0&&g.modal()}});d3.select(e).append("svg").attr("width",g).datum(d.data).call(i),c.useBootstrapTooltip===!0&&d3.select(e).selectAll("#line-path").attr("data-placement","top").attr("data-toggle","tooltip").attr("title",function(a){return a.title}).selectAll("title").remove(),c.timelineData=d,c.selectee=e}function d(b,c){var d="<rect width='20' height='20' x='2' y='2' rx='5' ry='5' style='fill:COLOR;'>".replace(/COLOR/,b);return a("<li><svg width='25' height='25'>"+d+"</svg>"+c+"</li>")}a.MicaTimeline=function(a,b,c){this.parser=a,this.popupIdFormatter=b,this.useBootstrapTooltip=c},a.MicaTimeline.prototype={create:function(a,b){var d=jQuery.extend(!0,{},b);if(null!==this.parser&&null!==d){var e=this.parser.parse(d);return e&&c(this,e,a,d),this}},addLegend:function(){if(this.timelineData&&this.timelineData.hasOwnProperty("data")&&0!==this.timelineData.data.length){var b=a("<ul id='legend' class='timeline-legend'>");a(this.selectee).after(b);var c={};return a.each(this.timelineData.data,function(e,f){if(!c.hasOwnProperty(f.title)){c[f.title]=!0;var g=a(d(f.color,f.title));b.append(g)}}),this}},reset:function(){return a(this.selectee).empty(),a(".timeline-legend").remove(),this}},a.MicaTimeline.defaultOptions={maxMonths:300}}(jQuery);