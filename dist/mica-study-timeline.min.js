!function(){"use strict";d3.timeline=function(){function a(a){function b(){return console.log(">>>>",d3.range(k.getFullYear(),l.getFullYear()+1)),d3.svg.axis().scale(C).orient("bottom").tickFormat("").tickSubdivide(1).tickValues(d3.range(k.getFullYear(),l.getFullYear()+1)).tickSize(-g,h.tickSize/2,0)}function i(a,b){return m.left+(a.starting_time-k)*B}function j(a,b){return(a.ending_time-a.starting_time)*B}function r(){if(g||w.attr("height"))g?w.attr("height",g):g=w.attr("height");else{if(!p)throw"height of the timeline is not set";g=E.height+E.top-v.top,d3.select(a[0][0]).attr("height",g)}}function s(){if(!f&&!v.width)throw"width of the timeline is not set";f&&v.width||(f?w.attr("width",f):f=w.attr("width"))}function t(a,b,c,d,e){return"M"+a+","+b+"h"+(c-e)+"a"+e+","+e+" 0 0 1 "+e+","+e+"v"+(d-2*e)+"a"+e+","+e+" 0 0 1 "+-e+","+e+"h"+(e-c)+"z"}var u=a.append("g"),v=a[0][0].getBoundingClientRect(),w=d3.select(a[0][0]),x={},y=1,z=0,A=0;s(),(n||0===l&&0===k)&&(u.each(function(a,b){a.forEach(function(a,b){n&&Object.keys(x).indexOf(b)==-1&&(x[b]=y,y++),0===l&&0===k&&a.events.forEach(function(a,b){(a.starting_time<z||0===z)&&(z=a.starting_time),a.ending_time>A&&(A=a.ending_time)})})}),0===l&&0===k&&(k=z,l=A));var B=1/(l-k)*(f-m.left-m.right),C=d3.time.scale().domain([k.getFullYear(),l.getFullYear()]).range([m.left,f-m.right]),D=d3.svg.axis().scale(C).orient(e).tickFormat(h.format).tickSubdivide(1).tickValues(d3.range(k.getFullYear(),l.getFullYear()+1)).tickSize(h.tickSize,h.tickSize/2,0);u.append("g").attr("class","axis").attr("transform","translate(0,"+(m.top+(p+q)*y)+")").call(D),o&&u.selectAll("text").attr("transform",function(a){return"rotate("+o+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"});var E=u[0][0].getBoundingClientRect();r(),u.append("g").attr("class","grid").attr("transform","translate(0,"+(g-2*h.tickSize)+")").call(b()),u.append("g").attr("class","grid-tooltip").attr("transform","translate(0,"+(g-2*h.tickSize)+")").call(b()),d3.selectAll(".grid-tooltip > .tick").each(function(a,b){d3.select(this).insert("title",":first-child").html(a)}),u.each(function(b,e){b.forEach(function(b,e){function f(a,b){return n?m.top+(p+q)*x[e]:m.top}var g=b.population.events,h="undefined"!=typeof b.label;u.selectAll("svg").data(g).enter().append("path").attr("id","line-path").attr("d",function(a,b){var c=i(a,b),d=f(a,b),e=j(a,b);return t(c,d,e,p,5)}).style("fill",b.population.color).on("mouseover",function(a,d){c(a,e,b)}).on("click",function(a,c){d(a,e,b)}).append("title").text(function(a){return a.title}),h&&a.append("text").attr("class","timeline-label").attr("transform","translate(0,"+(p/2+m.top+(p+q)*x[e])+")").text(h?b.label:b.id),"undefined"!=typeof b.icon&&a.append("image").attr("class","timeline-label").attr("transform","translate(0,"+(m.top+(p+q)*x[e])+")").attr("xlink:href",b.icon).attr("width",m.left).attr("height",p)})})}var b=["circle","rect"],c=function(){},d=function(){},e="bottom",f=null,g=null,h={format:d3.format("d"),tickTime:1,tickNumber:1,tickSize:10},i=d3.scale.category20(),j="rect",k=0,l=0,m={left:30,right:30,top:30,bottom:30},n=!1,o=!1,p=10,q=5;return a.margin=function(b){return arguments.length?(m=b,a):m},a.orient=function(b){return arguments.length?(e=b,a):e},a.itemHeight=function(b){return arguments.length?(p=b,a):p},a.itemMargin=function(b){return arguments.length?(q=b,a):q},a.height=function(b){return arguments.length?(g=b,a):g},a.width=function(b){return arguments.length?(f=b,a):f},a.display=function(c){return arguments.length&&b.indexOf(c)!=-1?(j=c,a):j},a.tickFormat=function(b){return arguments.length?(h=b,a):h},a.hover=function(b){return arguments.length?(c=b,a):c},a.click=function(b){return arguments.length?(d=b,a):d},a.colors=function(b){return arguments.length?(i=b,a):i},a.beginning=function(b){return arguments.length?(k=b,a):k},a.ending=function(b){return arguments.length?(l=b,a):l},a.rotateTicks=function(b){return o=b,a},a.stack=function(){return n=!n,a},a}}(),function(a){"use strict";function b(a){const b=a.split(/-/).map(function(a){return parseInt(a)});return c(b[0],b[1]-1,b[2])}function c(a,b,c){return new Date(a,b,c)}function d(a,b){return c(a,(b||1)-1,1)}function e(a,b){var d=(b||12)-1,e=new Date(a,d+1,0).getDate();return c(a,d,e)}function f(a){(a||[]).sort(function(a,b){return a.weight-b.weight})}function g(c){a.each(c,function(c,g){g.hasOwnProperty("dataCollectionEvents")&&(f(g.dataCollectionEvents),a.each(g.dataCollectionEvents,function(a,c){c.startDate=c.startDay?b(c.startDay):d(c.startYear,c.startMonth);var f=c.endYear;f||(f=l>c.startYear?l:c.startYear),c.endDate=c.endDay?b(c.endDay):e(f,c.endMonth)}))})}function h(b){var c=Number.MAX_VALUE,e=Number.MIN_VALUE;return a.each(b,function(b,d){d.hasOwnProperty("dataCollectionEvents")&&a.each(d.dataCollectionEvents,function(a,b){c=Math.min(c,b.startDate.getFullYear());var d=b.endDate.getFullYear();e<d&&(e=d)})}),{min:d(c),max:d(e+1)}}function i(a,b){var c=j(a,b);if(0===c.length)return null;var d={start:b.start,min:b.min,max:b.max,data:c};return d}function j(b,c){function d(b,d){return function(f,j){var k=[];i={},e(i,j,"id"),g(i,j,"name"),i.color=d.nextColor(),j.hasOwnProperty("dataCollectionEvents")&&j.dataCollectionEvents.length>0&&(h(k,i,j.dataCollectionEvents,c),a.each(k,function(a,c){b.push(c)}))}}function e(a,b,c){b.hasOwnProperty(c)&&(a[c]=b[c])}function f(b){var c=b[0].value;return a.each(b,function(a,b){b.lang==k&&(c=b.value)}),c}function g(a,b,c){b.hasOwnProperty(c)&&(a.title=f(b[c]))}function h(b,c,d,f){function h(a,b,c,d){return Math.min(b,d)-Math.max(c,a)>0}function i(a,b,c){var d=jQuery.extend({},a);return d.events=[j(b,c)],{population:d}}function j(a,b){var c={};return e(c,a,"id"),g(c,a,"name"),k(c,a,b),l(c,a,b),c}function k(a,b,c){a.starting_time=b.startDate}function l(a,b,c){a.ending_time=b.endDate}if(!jQuery.isEmptyObject(d)){var m=jQuery.extend(!0,{},d);a.each(m,function(a,d){if("0"===a)b.push(i(c,d,f));else{for(var e=b[b.length-1].population.events,g=d.startDate,k=d.endDate,l=!1,m=null,n=e.length-1;n>=0&&!l;n--)m=e[n],h(g,k,m.starting_time,m.ending_time)&&(b.push(i(c,d,f)),l=!0);l||e.push(j(d,f,m.groupId))}})}}if(null!==b&&b.hasOwnProperty("populations")){var i,j=new a.ColorGenerator,l=[];return a.each(b.populations,d(l,j)),l}}var k,l=(new Date).getFullYear();a.StudyDtoParser=function(a){k=a?a:"en"},a.StudyDtoParser.prototype={parse:function(a){return a.populations?(g(a.populations),i(a,h(a.populations))):null}}}(jQuery),function(a){"use strict";function b(a,b){var c=String(a).replace(/[^0-9a-f]/gi,"");c.length<6&&(c=c[0]+c[0]+c[1]+c[1]+c[2]+c[2]),b=b||0;var d,e,f="#";for(e=0;e<3;e++)d=parseInt(c.substr(2*e,2),16),d=Math.round(Math.min(Math.max(0,d+d*b),255)).toString(16),f+=("00"+d).substr(d.length);return f}var c=["#9a3034","#886e6a","#dc9351","#0078ad","#8db173","#bca68e","#707175","#ff7901","#88697b","#99c1c3","#306d05","#f25314"];a.ColorGenerator=function(a){this.colorPalette=jQuery.isEmptyObject(a)?c:a,this.index=0,this.rotation=1},a.ColorGenerator.prototype={nextColor:function(){var a=b(this.colorPalette[this.index],(this.rotation%10===0?-1:1)*this.rotation/70);return this.index=(this.index+1)%this.colorPalette.length,0===this.index&&this.rotation++,a}}}(jQuery),function(a){"use strict";function b(b,c,d,e){var f=a(d).width(),g=d3.timeline().beginning(c.min).ending(c.max).width(f).stack().tickFormat({format:d3.format("d"),tickTime:1,tickNumber:1,tickSize:10}).margin({left:15,right:15,top:0,bottom:20}).rotateTicks(c.max.getFullYear()-c.min.getFullYear()>30?45:0).click(function(c,d,f){if(b.popupIdFormatter){var g=a(b.popupIdFormatter(e,f.population,c));g.length>0&&g.modal()}});d3.select(d).append("svg").attr("width",f).datum(c.data).call(g),b.useBootstrapTooltip===!0&&d3.select(d).selectAll("#line-path").attr("data-placement","top").attr("data-toggle","tooltip").attr("title",function(a){return a.title}).selectAll("title").remove(),b.timelineData=c,b.selectee=d}function c(b,c){var d="<rect width='20' height='20' x='2' y='2' rx='5' ry='5' style='fill:COLOR;'>".replace(/COLOR/,b);return a("<li><svg width='25' height='25'>"+d+"</svg>"+c+"</li>")}a.MicaTimeline=function(a,b,c){this.parser=a,this.popupIdFormatter=b,this.useBootstrapTooltip=c},a.MicaTimeline.prototype={create:function(a,c){var d=jQuery.extend(!0,{},c);if(null!==this.parser&&null!==d){var e=this.parser.parse(d);return e&&b(this,e,a,d),this}},addLegend:function(){if(this.timelineData&&this.timelineData.hasOwnProperty("data")&&0!==this.timelineData.data.length){var b=a("<ul id='legend' class='timeline-legend'>");a(this.selectee).after(b);var d={};return a.each(this.timelineData.data,function(e,f){if(!d.hasOwnProperty(f.population.title)){d[f.population.title]=!0;var g=a(c(f.population.color,f.population.title));b.append(g)}}),this}},reset:function(){return a(this.selectee).empty(),a(".timeline-legend").remove(),this}},a.MicaTimeline.defaultOptions={maxMonths:300}}(jQuery);